<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Module      :   Grisette.Internal.TH.GADT.Common</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Copyright   :   (c) Sirui Lu 2024</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- License     :   BSD-3-Clause (see the LICENSE file)</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Maintainer  :   siruilu@cs.washington.edu</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Stability   :   Experimental</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Portability :   GHC only</span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html"><span class="hs-identifier">Grisette.Internal.TH.GADT.Common</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier">CheckArgsResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#checkArgs"><span class="hs-identifier">checkArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#ctxForVar"><span class="hs-identifier">ctxForVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeConfig"><span class="hs-identifier">EvalModeConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier">DeriveConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraEvalModeConstraint"><span class="hs-identifier">extraEvalModeConstraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraBitSizeConstraint"><span class="hs-identifier">extraBitSizeConstraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraFpBitSizeConstraint"><span class="hs-identifier">extraFpBitSizeConstraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraExtraMergeableConstraint"><span class="hs-identifier">extraExtraMergeableConstraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraConstraint"><span class="hs-identifier">extraConstraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#specializeResult"><span class="hs-identifier">specializeResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#evalModeSpecializeList"><span class="hs-identifier">evalModeSpecializeList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#isVarUsedInFields"><span class="hs-identifier">isVarUsedInFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#freshenCheckArgsResult"><span class="hs-identifier">freshenCheckArgsResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWithM</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">KnownNat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Nat</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(&lt;=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Grisette.Internal.Internal.Decl.Core.Data.Class.Mergeable.html"><span class="hs-identifier">Grisette.Internal.Internal.Decl.Core.Data.Class.Mergeable</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Grisette.Internal.Internal.Decl.Core.Data.Class.Mergeable.html#Mergeable"><span class="hs-identifier">Mergeable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Grisette.Internal.Internal.Decl.Core.Data.Class.Mergeable.html#Mergeable1"><span class="hs-identifier">Mergeable1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Grisette.Internal.Internal.Decl.Core.Data.Class.Mergeable.html#Mergeable2"><span class="hs-identifier">Mergeable2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Grisette.Internal.SymPrim.FP.html"><span class="hs-identifier">Grisette.Internal.SymPrim.FP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Grisette.Internal.SymPrim.FP.html#ValidFP"><span class="hs-identifier">ValidFP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Grisette.Internal.Unified.EvalModeTag.html"><span class="hs-identifier">Grisette.Internal.Unified.EvalModeTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Grisette.Internal.Unified.EvalModeTag.html#EvalModeTag"><span class="hs-identifier">EvalModeTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Grisette.Internal.Unified.EvalModeTag.html#C"><span class="hs-identifier">C</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.Unified.EvalModeTag.html#S"><span class="hs-identifier">S</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Grisette.Internal.Unified.Util.html"><span class="hs-identifier">Grisette.Internal.Unified.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Grisette.Internal.Unified.Util.html#DecideEvalMode"><span class="hs-identifier">DecideEvalMode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Kind</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="hs-identifier">Pred</span></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-identifier">Q</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-identifier">Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AppT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ArrowT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ConT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PromotedT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StarT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">VarT</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-identifier">conT</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-identifier">nameBase</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="hs-identifier">newName</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Datatype</span></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ConstructorInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">constructorFields</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">constructorName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">constructorVars</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="hs-identifier">DatatypeInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">datatypeCons</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">datatypeVars</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><span class="hs-identifier">TypeSubstitution</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">applySubstitution</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">freeVariables</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="hs-identifier">reifyDatatype</span></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-identifier">tvName</span></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Datatype.TyVarBndr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapTVName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tvKind</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><span class="hs-comment">-- | Result of 'checkArgs' for a GADT.</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">data</span><span> </span><span id="CheckArgsResult"><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-var">CheckArgsResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CheckArgsResult"><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-var">CheckArgsResult</span></a></span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="constructors"><span class="annot"><span class="annottext">CheckArgsResult -&gt; [ConstructorInfo]
</span><a href="Grisette.Internal.TH.GADT.Common.html#constructors"><span class="hs-identifier hs-var hs-var">constructors</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ConstructorInfo</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span id="keptVars"><span class="annot"><span class="annottext">CheckArgsResult -&gt; [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#keptVars"><span class="hs-identifier hs-var hs-var">keptVars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span id="argVars"><span class="annot"><span class="annottext">CheckArgsResult -&gt; [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#argVars"><span class="hs-identifier hs-var hs-var">argVars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><span class="hs-comment">-- | Specialize the evaluation mode tags for the t'CheckArgsResult'.</span></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#specializeResult"><span class="hs-identifier hs-type">specializeResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.Unified.EvalModeTag.html#EvalModeTag"><span class="hs-identifier hs-type">EvalModeTag</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-type">CheckArgsResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-type">CheckArgsResult</span></a></span><span>
</span><span id="line-77"></span><span id="specializeResult"><span class="annot"><span class="annottext">specializeResult :: [(Int, EvalModeTag)] -&gt; CheckArgsResult -&gt; Q CheckArgsResult
</span><a href="Grisette.Internal.TH.GADT.Common.html#specializeResult"><span class="hs-identifier hs-var hs-var">specializeResult</span></a></span></span><span> </span><span id="local-6989586621682274565"><span class="annot"><span class="annottext">[(Int, EvalModeTag)]
</span><a href="#local-6989586621682274565"><span class="hs-identifier hs-var">evalModeConfigs</span></a></span></span><span> </span><span id="local-6989586621682274566"><span class="annot"><span class="annottext">CheckArgsResult
</span><a href="#local-6989586621682274566"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274567"><span class="annot"><span class="annottext">modeToName :: EvalModeTag -&gt; Name
</span><a href="#local-6989586621682274567"><span class="hs-identifier hs-var hs-var hs-var">modeToName</span></a></span></span><span> </span><span class="annot"><span class="annottext">EvalModeTag
</span><a href="Grisette.Internal.Unified.EvalModeTag.html#C"><span class="hs-identifier hs-var">C</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">C</span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><a href="#local-6989586621682274567"><span class="hs-identifier hs-var">modeToName</span></a></span><span> </span><span class="annot"><span class="annottext">EvalModeTag
</span><a href="Grisette.Internal.Unified.EvalModeTag.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">S</span><span>
</span><span id="line-80"></span><span>  </span><span id="local-6989586621682274568"><span class="annot"><a href="#local-6989586621682274568"><span class="hs-identifier hs-var">map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="annottext">([(Kind, Kind)] -&gt; (Int, EvalModeTag) -&gt; Q [(Kind, Kind)])
-&gt; [(Kind, Kind)] -&gt; [(Int, EvalModeTag)] -&gt; Q [(Kind, Kind)]
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span>
</span><span id="line-82"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682274569"><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274569"><span class="hs-identifier hs-var">lst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682274570"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274570"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274571"><span class="annot"><span class="annottext">EvalModeTag
</span><a href="#local-6989586621682274571"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274574"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274574"><span class="hs-identifier hs-var">knd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274569"><span class="hs-identifier hs-var">lst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int -&gt; (Kind, Kind)
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274570"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-84"></span><span>          </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Q [(Kind, Kind)]
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([(Kind, Kind)] -&gt; Q [(Kind, Kind)])
-&gt; [(Kind, Kind)] -&gt; Q [(Kind, Kind)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-85"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; [(Kind, Kind)] -&gt; [(Kind, Kind)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274570"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274569"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-86"></span><span>              </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; [(Kind, Kind)] -&gt; [(Kind, Kind)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">PromotedT</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Kind) -&gt; Name -&gt; Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvalModeTag -&gt; Name
</span><a href="#local-6989586621682274567"><span class="hs-identifier hs-var">modeToName</span></a></span><span> </span><span class="annot"><span class="annottext">EvalModeTag
</span><a href="#local-6989586621682274571"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274574"><span class="hs-identifier hs-var">knd</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-87"></span><span>              </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; [(Kind, Kind)] -&gt; [(Kind, Kind)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Kind, Kind)] -&gt; [(Kind, Kind)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274570"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274569"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckArgsResult -&gt; [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#keptVars"><span class="hs-identifier hs-var">keptVars</span></a></span><span> </span><span class="annot"><span class="annottext">CheckArgsResult
</span><a href="#local-6989586621682274566"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><span class="annottext">[(Int, EvalModeTag)]
</span><a href="#local-6989586621682274565"><span class="hs-identifier hs-var">evalModeConfigs</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682274566"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#keptVars"><span class="hs-identifier hs-var">keptVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682274568"><span class="hs-identifier hs-type">map</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#freshenConstructorInfo"><span class="hs-identifier hs-type">freshenConstructorInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConstructorInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConstructorInfo</span></span><span>
</span><span id="line-94"></span><span id="freshenConstructorInfo"><span class="annot"><span class="annottext">freshenConstructorInfo :: ConstructorInfo -&gt; Q ConstructorInfo
</span><a href="Grisette.Internal.TH.GADT.Common.html#freshenConstructorInfo"><span class="hs-identifier hs-var hs-var">freshenConstructorInfo</span></a></span></span><span> </span><span id="local-6989586621682274580"><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274580"><span class="hs-identifier hs-var">conInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274581"><span class="annot"><span class="annottext">vars :: [TyVarBndrUnit]
</span><a href="#local-6989586621682274581"><span class="hs-identifier hs-var hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">constructorVars</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274580"><span class="hs-identifier hs-var">conInfo</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621682274582"><span class="annot"><a href="#local-6989586621682274582"><span class="hs-identifier hs-var">newNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TyVarBndrUnit -&gt; Q Name) -&gt; [TyVarBndrUnit] -&gt; Q [Name]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Q Name
forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q Name)
-&gt; (TyVarBndrUnit -&gt; String) -&gt; TyVarBndrUnit -&gt; Q Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; String)
-&gt; (TyVarBndrUnit -&gt; Name) -&gt; TyVarBndrUnit -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Name
forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">tvName</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621682274581"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274585"><span class="annot"><a href="#local-6989586621682274585"><span class="hs-identifier hs-var hs-var">newVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TyVarBndrUnit -&gt; TyVarBndrUnit)
-&gt; [Name] -&gt; [TyVarBndrUnit] -&gt; [TyVarBndrUnit]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; TyVarBndrUnit -&gt; TyVarBndrUnit
forall flag. (Name -&gt; Name) -&gt; TyVarBndr_ flag -&gt; TyVarBndr_ flag
</span><span class="hs-identifier hs-var">mapTVName</span></span><span> </span><span class="annot"><span class="annottext">((Name -&gt; Name) -&gt; TyVarBndrUnit -&gt; TyVarBndrUnit)
-&gt; (Name -&gt; Name -&gt; Name) -&gt; Name -&gt; TyVarBndrUnit -&gt; TyVarBndrUnit
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682274582"><span class="hs-identifier hs-var">newNames</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621682274581"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274592"><span class="annot"><a href="#local-6989586621682274592"><span class="hs-identifier hs-var hs-var">substMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Kind)] -&gt; Map Name Kind
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Name, Kind)] -&gt; Map Name Kind)
-&gt; [(Name, Kind)] -&gt; Map Name Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Kind] -&gt; [(Name, Kind)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Name
forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">tvName</span></span><span> </span><span class="annot"><span class="annottext">(TyVarBndrUnit -&gt; Name) -&gt; [TyVarBndrUnit] -&gt; [Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621682274581"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Kind] -&gt; [(Name, Kind)]) -&gt; [Kind] -&gt; [(Name, Kind)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Kind) -&gt; [Name] -&gt; [Kind]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682274582"><span class="hs-identifier hs-var">newNames</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">applySubstitution</span></span><span> </span><span class="annot"><a href="#local-6989586621682274592"><span class="hs-identifier hs-type">substMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274580"><span class="hs-identifier hs-type">conInfo</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">constructorVars</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682274585"><span class="hs-identifier hs-type">newVars</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><span class="hs-comment">-- | Freshen the type variables in the t'CheckArgsResult'.</span></span><span>
</span><span id="line-102"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#freshenCheckArgsResult"><span class="hs-identifier hs-type">freshenCheckArgsResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-type">CheckArgsResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-type">CheckArgsResult</span></a></span><span>
</span><span id="line-103"></span><span id="freshenCheckArgsResult"><span class="annot"><span class="annottext">freshenCheckArgsResult :: Bool -&gt; CheckArgsResult -&gt; Q CheckArgsResult
</span><a href="Grisette.Internal.TH.GADT.Common.html#freshenCheckArgsResult"><span class="hs-identifier hs-var hs-var">freshenCheckArgsResult</span></a></span></span><span> </span><span id="local-6989586621682274595"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682274595"><span class="hs-identifier hs-var">freshenNats</span></a></span></span><span> </span><span id="local-6989586621682274596"><span class="annot"><span class="annottext">CheckArgsResult
</span><a href="#local-6989586621682274596"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682274597"><span class="hs-identifier hs-type">genNewName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>      </span><span id="local-6989586621682274597"><span class="annot"><span class="annottext">genNewName :: (Kind, Kind) -&gt; Q (Maybe Name)
</span><a href="#local-6989586621682274597"><span class="hs-identifier hs-var hs-var hs-var">genNewName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274598"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274598"><span class="hs-identifier hs-var">knd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-106"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682274595"><span class="hs-identifier hs-var">freshenNats</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274598"><span class="hs-identifier hs-var">knd</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Nat</span><span>
</span><span id="line-107"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Q (Maybe Name)
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-108"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe Name) -&gt; Q Name -&gt; Q (Maybe Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Name
forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><a href="#local-6989586621682274597"><span class="hs-identifier hs-var">genNewName</span></a></span><span> </span><span class="annot"><span class="annottext">(Kind, Kind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Q (Maybe Name)
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-110"></span><span>  </span><span id="local-6989586621682274601"><span class="annot"><a href="#local-6989586621682274601"><span class="hs-identifier hs-var">keptNewNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Kind, Kind) -&gt; Q (Maybe Name))
-&gt; [(Kind, Kind)] -&gt; Q [Maybe Name]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(Kind, Kind) -&gt; Q (Maybe Name)
</span><a href="#local-6989586621682274597"><span class="hs-identifier hs-var">genNewName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckArgsResult -&gt; [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#keptVars"><span class="hs-identifier hs-var">keptVars</span></a></span><span> </span><span class="annot"><span class="annottext">CheckArgsResult
</span><a href="#local-6989586621682274596"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621682274602"><span class="annot"><a href="#local-6989586621682274602"><span class="hs-identifier hs-var">argNewNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="annot"><a href="#local-6989586621682274597"><span class="hs-identifier hs-type">genNewName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#argVars"><span class="hs-identifier hs-var">argVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274596"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274604"><span class="annot"><a href="#local-6989586621682274604"><span class="hs-identifier hs-var hs-var">substMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">[(Name, Kind)] -&gt; Map Name Kind
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-115"></span><span>          </span><span class="annot"><span class="annottext">([(Name, Kind)] -&gt; Map Name Kind)
-&gt; [(Name, Kind)] -&gt; Map Name Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Maybe Name, (Kind, Kind)) -&gt; Maybe (Name, Kind))
-&gt; [(Maybe Name, (Kind, Kind))] -&gt; [(Name, Kind)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-116"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682274605"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682274605"><span class="hs-identifier hs-var">newName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274606"><span class="annot"><span class="annottext">(Kind, Kind)
</span><a href="#local-6989586621682274606"><span class="hs-identifier hs-var">oldVar</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-117"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621682274605"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Kind, Kind)
</span><a href="#local-6989586621682274606"><span class="hs-identifier hs-var">oldVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-118"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682274607"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274607"><span class="hs-identifier hs-var">newName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span id="local-6989586621682274608"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274608"><span class="hs-identifier hs-var">oldName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>                    </span><span class="annot"><span class="annottext">(Name, Kind) -&gt; Maybe (Name, Kind)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274608"><span class="hs-identifier hs-var">oldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274607"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>                  </span><span class="annot"><span class="annottext">(Maybe Name, (Kind, Kind))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Name, Kind)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-121"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><span class="annottext">([(Maybe Name, (Kind, Kind))] -&gt; [(Name, Kind)])
-&gt; [(Maybe Name, (Kind, Kind))] -&gt; [(Name, Kind)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Name] -&gt; [(Kind, Kind)] -&gt; [(Maybe Name, (Kind, Kind))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span>
</span><span id="line-123"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621682274601"><span class="hs-identifier hs-var">keptNewNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Name] -&gt; [Maybe Name] -&gt; [Maybe Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621682274602"><span class="hs-identifier hs-var">argNewNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckArgsResult -&gt; [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#keptVars"><span class="hs-identifier hs-var">keptVars</span></a></span><span> </span><span class="annot"><span class="annottext">CheckArgsResult
</span><a href="#local-6989586621682274596"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; [(Kind, Kind)] -&gt; [(Kind, Kind)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">CheckArgsResult -&gt; [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#argVars"><span class="hs-identifier hs-var">argVars</span></a></span><span> </span><span class="annot"><span class="annottext">CheckArgsResult
</span><a href="#local-6989586621682274596"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621682274609"><span class="annot"><a href="#local-6989586621682274609"><span class="hs-identifier hs-var">constructors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#freshenConstructorInfo"><span class="hs-identifier hs-type">freshenConstructorInfo</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-127"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">applySubstitution</span></span><span> </span><span class="annot"><a href="#local-6989586621682274604"><span class="hs-identifier hs-type">substMap</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#constructors"><span class="hs-identifier hs-var">constructors</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274596"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274616"><span class="annot"><a href="#local-6989586621682274616"><span class="hs-identifier hs-var hs-var">newKeptVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; Kind) -&gt; (Kind, Kind) -&gt; (Kind, Kind)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Kind -&gt; Kind -&gt; Kind
forall a. TypeSubstitution a =&gt; Map Name Kind -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">applySubstitution</span></span><span> </span><span class="annot"><span class="annottext">Map Name Kind
</span><a href="#local-6989586621682274604"><span class="hs-identifier hs-var">substMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Kind, Kind) -&gt; (Kind, Kind)) -&gt; [(Kind, Kind)] -&gt; [(Kind, Kind)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckArgsResult -&gt; [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#keptVars"><span class="hs-identifier hs-var">keptVars</span></a></span><span> </span><span class="annot"><span class="annottext">CheckArgsResult
</span><a href="#local-6989586621682274596"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274620"><span class="annot"><a href="#local-6989586621682274620"><span class="hs-identifier hs-var hs-var">newArgVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; Kind) -&gt; (Kind, Kind) -&gt; (Kind, Kind)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name Kind -&gt; Kind -&gt; Kind
forall a. TypeSubstitution a =&gt; Map Name Kind -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">applySubstitution</span></span><span> </span><span class="annot"><span class="annottext">Map Name Kind
</span><a href="#local-6989586621682274604"><span class="hs-identifier hs-var">substMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Kind, Kind) -&gt; (Kind, Kind)) -&gt; [(Kind, Kind)] -&gt; [(Kind, Kind)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckArgsResult -&gt; [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#argVars"><span class="hs-identifier hs-var">argVars</span></a></span><span> </span><span class="annot"><span class="annottext">CheckArgsResult
</span><a href="#local-6989586621682274596"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><a href="#local-6989586621682274596"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#constructors"><span class="hs-identifier hs-var">constructors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682274609"><span class="hs-identifier hs-type">constructors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#keptVars"><span class="hs-identifier hs-var">keptVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682274616"><span class="hs-identifier hs-type">newKeptVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#argVars"><span class="hs-identifier hs-var">argVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682274620"><span class="hs-identifier hs-type">newArgVars</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | Check if the number of type parameters is valid for a GADT, and return</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- new names for the type variables, split into kept and arg parts.</span><span>
</span><span id="line-140"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#checkArgs"><span class="hs-identifier hs-type">checkArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-type">CheckArgsResult</span></a></span><span>
</span><span id="line-147"></span><span id="checkArgs"><span class="annot"><span class="annottext">checkArgs :: String -&gt; Int -&gt; Name -&gt; Bool -&gt; Int -&gt; Q CheckArgsResult
</span><a href="Grisette.Internal.TH.GADT.Common.html#checkArgs"><span class="hs-identifier hs-var hs-var">checkArgs</span></a></span></span><span> </span><span id="local-6989586621682274621"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682274621"><span class="hs-identifier hs-var">clsName</span></a></span></span><span> </span><span id="local-6989586621682274622"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274622"><span class="hs-identifier hs-var">maxArgNum</span></a></span></span><span> </span><span id="local-6989586621682274623"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274623"><span class="hs-identifier hs-var">typName</span></a></span></span><span> </span><span id="local-6989586621682274624"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682274624"><span class="hs-identifier hs-var">allowExistential</span></a></span></span><span> </span><span id="local-6989586621682274625"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Q () -&gt; Q ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; Q ()) -&gt; Q () -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Q ()
forall a. String -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q ()) -&gt; String -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot derive &quot;</span></span><span>
</span><span id="line-152"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682274621"><span class="hs-identifier hs-var">clsName</span></a></span><span>
</span><span id="line-153"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; instance with negative type parameters&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tRequested: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tHint: Use a non-negative number of type parameters&quot;</span></span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Q () -&gt; Q ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274622"><span class="hs-identifier hs-var">maxArgNum</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; Q ()) -&gt; Q () -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Q ()
forall a. String -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q ()) -&gt; String -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot derive &quot;</span></span><span>
</span><span id="line-161"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682274621"><span class="hs-identifier hs-var">clsName</span></a></span><span>
</span><span id="line-162"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; instance with more than &quot;</span></span><span>
</span><span id="line-163"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274622"><span class="hs-identifier hs-var">maxArgNum</span></a></span><span>
</span><span id="line-164"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; type parameters&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tRequested: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621682274630"><span class="annot"><a href="#local-6989586621682274630"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Q DatatypeInfo
</span><span class="hs-identifier hs-var">reifyDatatype</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274623"><span class="hs-identifier hs-var">typName</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274631"><span class="annot"><a href="#local-6989586621682274631"><span class="hs-identifier hs-var hs-var">dvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">datatypeVars</span></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621682274630"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682274631"><span class="hs-identifier hs-type">dvars</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682274625"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">fail</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">unlines</span></span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;Cannot derive &quot;</span></span><span>
</span><span id="line-173"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682274621"><span class="hs-identifier hs-type">clsName</span></a></span><span>
</span><span id="line-174"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682274625"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-175"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; instance for the type &quot;</span></span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682274623"><span class="hs-identifier hs-type">typName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>          </span><span class="annot"><span class="hs-string">&quot;\tReason: The type &quot;</span></span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682274623"><span class="hs-identifier hs-type">typName</span></a></span><span>
</span><span id="line-179"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; has only &quot;</span></span><span>
</span><span id="line-180"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682274631"><span class="hs-identifier hs-type">dvars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; type variables.&quot;</span></span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274636"><span class="annot"><a href="#local-6989586621682274636"><span class="hs-identifier hs-var hs-var">keptVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682274637"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621682274637"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Kind) -&gt; Name -&gt; Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Name
forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">tvName</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621682274637"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Kind
forall flag. TyVarBndr_ flag -&gt; Kind
</span><span class="hs-identifier hs-var">tvKind</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621682274637"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>          </span><span class="annot"><span class="annottext">(TyVarBndrUnit -&gt; (Kind, Kind))
-&gt; [TyVarBndrUnit] -&gt; [(Kind, Kind)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [TyVarBndrUnit] -&gt; [TyVarBndrUnit]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621682274631"><span class="hs-identifier hs-var">dvars</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621682274631"><span class="hs-identifier hs-var">dvars</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274641"><span class="annot"><a href="#local-6989586621682274641"><span class="hs-identifier hs-var hs-var">argVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682274642"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621682274642"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Kind) -&gt; Name -&gt; Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Name
forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">tvName</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621682274642"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Kind
forall flag. TyVarBndr_ flag -&gt; Kind
</span><span class="hs-identifier hs-var">tvKind</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621682274642"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>          </span><span class="annot"><span class="annottext">(TyVarBndrUnit -&gt; (Kind, Kind))
-&gt; [TyVarBndrUnit] -&gt; [(Kind, Kind)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [TyVarBndrUnit] -&gt; [TyVarBndrUnit]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621682274631"><span class="hs-identifier hs-var">dvars</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621682274631"><span class="hs-identifier hs-var">dvars</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274643"><span class="annot"><a href="#local-6989586621682274643"><span class="hs-identifier hs-var hs-var">constructors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; [ConstructorInfo]
</span><span class="hs-identifier hs-var">datatypeCons</span></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621682274630"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621682274624"><span class="hs-identifier hs-type">allowExistential</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span>
</span><span id="line-192"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682274645"><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274645"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-193"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Q () -&gt; Q ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstructorInfo -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">constructorVars</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274645"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; [TyVarBndrUnit] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; Q ()) -&gt; Q () -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-194"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Q ()
forall a. String -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q ()) -&gt; String -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-195"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-196"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot derive &quot;</span></span><span>
</span><span id="line-197"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682274621"><span class="hs-identifier hs-var">clsName</span></a></span><span>
</span><span id="line-198"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-199"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; instance for the type &quot;</span></span><span>
</span><span id="line-200"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274623"><span class="hs-identifier hs-var">typName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-201"></span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tReason: The constructor &quot;</span></span><span>
</span><span id="line-202"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstructorInfo -&gt; Name
</span><span class="hs-identifier hs-var">constructorName</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274645"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; has existential variables&quot;</span></span><span>
</span><span id="line-204"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><a href="#local-6989586621682274643"><span class="hs-identifier hs-type">constructors</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682274647"><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274647"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274648"><span class="annot"><span class="annottext">fields :: [Kind]
</span><a href="#local-6989586621682274648"><span class="hs-identifier hs-var hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; [Kind]
</span><span class="hs-identifier hs-var">constructorFields</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274647"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274650"><span class="annot"><span class="annottext">existentialVars :: [Name]
</span><a href="#local-6989586621682274650"><span class="hs-identifier hs-var hs-var hs-var">existentialVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Name
forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">tvName</span></span><span> </span><span class="annot"><span class="annottext">(TyVarBndrUnit -&gt; Name) -&gt; [TyVarBndrUnit] -&gt; [Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">constructorVars</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274647"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274653"><span class="annot"><span class="annottext">fieldReferencedVars :: [Name]
</span><a href="#local-6989586621682274653"><span class="hs-identifier hs-var hs-var hs-var">fieldReferencedVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; [Name]
forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><span class="hs-identifier hs-var">freeVariables</span></span><span> </span><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621682274648"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274657"><span class="annot"><span class="annottext">notReferencedVars :: Set Name
</span><a href="#local-6989586621682274657"><span class="hs-identifier hs-var hs-var">notReferencedVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>              </span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682274650"><span class="hs-identifier hs-var">existentialVars</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Set Name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">S.\\</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682274653"><span class="hs-identifier hs-var">fieldReferencedVars</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Q () -&gt; Q ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name -&gt; Bool
forall a. Set a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621682274657"><span class="hs-identifier hs-var">notReferencedVars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; Q ()) -&gt; Q () -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-215"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Q ()
forall a. String -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q ()) -&gt; String -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-216"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-217"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot derive &quot;</span></span><span>
</span><span id="line-218"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682274621"><span class="hs-identifier hs-var">clsName</span></a></span><span>
</span><span id="line-219"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274625"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-220"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; instance for the type &quot;</span></span><span>
</span><span id="line-221"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274623"><span class="hs-identifier hs-var">typName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Reason: Ambiguous existential variable in the constructor: &quot;</span></span><span>
</span><span id="line-223"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstructorInfo -&gt; Name
</span><span class="hs-identifier hs-var">constructorName</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo
</span><a href="#local-6989586621682274647"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, this is not supported. Please consider binding the &quot;</span></span><span>
</span><span id="line-225"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;existential variable to a field. You can use Proxy type to &quot;</span></span><span>
</span><span id="line-226"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;do this.&quot;</span></span><span>
</span><span id="line-227"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><a href="#local-6989586621682274643"><span class="hs-identifier hs-type">constructors</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-type">CheckArgsResult</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#constructors"><span class="hs-glyph hs-var hs-var hs-var hs-type hs-type hs-type">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#isVarUsedInConstructorFields"><span class="hs-identifier hs-type">isVarUsedInConstructorFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ConstructorInfo</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-233"></span><span id="isVarUsedInConstructorFields"><span class="annot"><span class="annottext">isVarUsedInConstructorFields :: [ConstructorInfo] -&gt; Name -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#isVarUsedInConstructorFields"><span class="hs-identifier hs-var hs-var">isVarUsedInConstructorFields</span></a></span></span><span> </span><span id="local-6989586621682274662"><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621682274662"><span class="hs-identifier hs-var">constructors</span></a></span></span><span> </span><span id="local-6989586621682274663"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274663"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274665"><span class="annot"><span class="annottext">allFields :: [Kind]
</span><a href="#local-6989586621682274665"><span class="hs-identifier hs-var hs-var">allFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ConstructorInfo -&gt; [Kind]) -&gt; [ConstructorInfo] -&gt; [Kind]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; [Kind]
</span><span class="hs-identifier hs-var">constructorFields</span></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621682274662"><span class="hs-identifier hs-var">constructors</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span id="local-6989586621682274670"><span class="annot"><span class="annottext">allFieldsFreeVars :: Set Name
</span><a href="#local-6989586621682274670"><span class="hs-identifier hs-var hs-var">allFieldsFreeVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Set Name) -&gt; [Name] -&gt; Set Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; [Name]
forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><span class="hs-identifier hs-var">freeVariables</span></span><span> </span><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621682274665"><span class="hs-identifier hs-var">allFields</span></a></span><span>
</span><span id="line-236"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274663"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621682274670"><span class="hs-identifier hs-var">allFieldsFreeVars</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><span class="hs-comment">-- | Check if a variable is used in the fields of a constructor.</span></span><span>
</span><span id="line-239"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#isVarUsedInFields"><span class="hs-identifier hs-type">isVarUsedInFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-type">CheckArgsResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-240"></span><span id="isVarUsedInFields"><span class="annot"><span class="annottext">isVarUsedInFields :: CheckArgsResult -&gt; Name -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#isVarUsedInFields"><span class="hs-identifier hs-var hs-var">isVarUsedInFields</span></a></span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#CheckArgsResult"><span class="hs-identifier hs-type">CheckArgsResult</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682274672"><span id="local-6989586621682274673"><span id="local-6989586621682274674"><span class="annot"><span class="annottext">[(Kind, Kind)]
[ConstructorInfo]
constructors :: CheckArgsResult -&gt; [ConstructorInfo]
keptVars :: CheckArgsResult -&gt; [(Kind, Kind)]
argVars :: CheckArgsResult -&gt; [(Kind, Kind)]
constructors :: [ConstructorInfo]
keptVars :: [(Kind, Kind)]
argVars :: [(Kind, Kind)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#constructors"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">[ConstructorInfo] -&gt; Name -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#isVarUsedInConstructorFields"><span class="hs-identifier hs-var">isVarUsedInConstructorFields</span></a></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621682274672"><span class="hs-identifier hs-var">constructors</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><span class="hs-comment">-- | Generate a context for a variable in a GADT.</span></span><span>
</span><span id="line-244"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#ctxForVar"><span class="hs-identifier hs-type">ctxForVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pred</span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span id="ctxForVar"><span class="annot"><span class="annottext">ctxForVar :: [Kind] -&gt; Kind -&gt; Kind -&gt; Q (Maybe Kind)
</span><a href="Grisette.Internal.TH.GADT.Common.html#ctxForVar"><span class="hs-identifier hs-var hs-var">ctxForVar</span></a></span></span><span> </span><span id="local-6989586621682274675"><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621682274675"><span class="hs-identifier hs-var">instanceExps</span></a></span></span><span> </span><span id="local-6989586621682274676"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274676"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682274677"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274677"><span class="hs-identifier hs-var">knd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274677"><span class="hs-identifier hs-var">knd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="annottext">Kind -&gt; Maybe Kind
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-248"></span><span>      </span><span class="annot"><span class="annottext">(Kind -&gt; Maybe Kind) -&gt; Q Kind -&gt; Q (Maybe Kind)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">[t|</span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; Q Kind) -&gt; Kind -&gt; Q Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Kind
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621682274675"><span class="hs-identifier hs-var">instanceExps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274676"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">Kind -&gt; Maybe Kind
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">(Kind -&gt; Maybe Kind) -&gt; Q Kind -&gt; Q (Maybe Kind)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">[t|</span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; Q Kind) -&gt; Kind -&gt; Q Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621682274675"><span class="hs-identifier hs-var">instanceExps</span></a></span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Int -&gt; Kind
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274676"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><span class="annottext">Kind -&gt; Maybe Kind
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-254"></span><span>      </span><span class="annot"><span class="annottext">(Kind -&gt; Maybe Kind) -&gt; Q Kind -&gt; Q (Maybe Kind)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">[t|</span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; Q Kind) -&gt; Kind -&gt; Q Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621682274675"><span class="hs-identifier hs-var">instanceExps</span></a></span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Int -&gt; Kind
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274676"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">Kind -&gt; Maybe Kind
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="annottext">(Kind -&gt; Maybe Kind) -&gt; Q Kind -&gt; Q (Maybe Kind)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">[t|</span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; Q Kind) -&gt; Kind -&gt; Q Kind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621682274675"><span class="hs-identifier hs-var">instanceExps</span></a></span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Int -&gt; Kind
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274676"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Q (Maybe Kind)
forall a. String -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q (Maybe Kind)) -&gt; String -&gt; Q (Maybe Kind)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsupported kind: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274677"><span class="hs-identifier hs-var">knd</span></a></span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Kind -&gt; Q (Maybe Kind)
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Configuration for constraints for evaluation modes tag.</span><span>
</span><span id="line-263"></span><span class="hs-comment">--</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- * 'EvalModeConstraints' specifies a list of constraints for the tag, for</span><span>
</span><span id="line-265"></span><span class="hs-comment">--   example, we may use 'Grisette.Unified.EvalModeBase' and</span><span>
</span><span id="line-266"></span><span class="hs-comment">--   'Grisette.Unified.EvalModeBV' to specify that the evaluation mode must</span><span>
</span><span id="line-267"></span><span class="hs-comment">--   support both base (boolean and data types) and bit vectors. This should be</span><span>
</span><span id="line-268"></span><span class="hs-comment">--   used when the data type uses bit vectors.</span><span>
</span><span id="line-269"></span><span class="hs-comment">--</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- * 'EvalModeSpecified' specifies a that an evaluation mode tag should be</span><span>
</span><span id="line-271"></span><span class="hs-comment">--   specialized to a specific tag for all the instances.</span><span>
</span><span id="line-272"></span><span class="hs-keyword">data</span><span> </span><span id="EvalModeConfig"><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeConfig"><span class="hs-identifier hs-var">EvalModeConfig</span></a></span></span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="EvalModeConstraints"><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeConstraints"><span class="hs-identifier hs-var">EvalModeConstraints</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="EvalModeSpecified"><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeSpecified"><span class="hs-identifier hs-var">EvalModeSpecified</span></a></span></span><span> </span><span class="annot"><a href="Grisette.Internal.Unified.EvalModeTag.html#EvalModeTag"><span class="hs-identifier hs-type">EvalModeTag</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><span class="hs-comment">-- | Configuration for deriving instances for a GADT.</span></span><span>
</span><span id="line-277"></span><span class="hs-keyword">data</span><span> </span><span id="DeriveConfig"><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-var">DeriveConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DeriveConfig"><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-var">DeriveConfig</span></a></span></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="evalModeConfig"><span class="annot"><span class="annottext">DeriveConfig -&gt; [(Int, EvalModeConfig)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#evalModeConfig"><span class="hs-identifier hs-var hs-var">evalModeConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeConfig"><span class="hs-identifier hs-type">EvalModeConfig</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>    </span><span id="bitSizePositions"><span class="annot"><span class="annottext">DeriveConfig -&gt; [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#bitSizePositions"><span class="hs-identifier hs-var hs-var">bitSizePositions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>    </span><span id="fpBitSizePositions"><span class="annot"><span class="annottext">DeriveConfig -&gt; [(Int, Int)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#fpBitSizePositions"><span class="hs-identifier hs-var hs-var">fpBitSizePositions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>    </span><span id="unconstrainedPositions"><span class="annot"><span class="annottext">DeriveConfig -&gt; [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#unconstrainedPositions"><span class="hs-identifier hs-var hs-var">unconstrainedPositions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>    </span><span id="needExtraMergeableUnderEvalMode"><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#needExtraMergeableUnderEvalMode"><span class="hs-identifier hs-var hs-var">needExtraMergeableUnderEvalMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>    </span><span id="needExtraMergeableWithConcretizedEvalMode"><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#needExtraMergeableWithConcretizedEvalMode"><span class="hs-identifier hs-var hs-var">needExtraMergeableWithConcretizedEvalMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>    </span><span id="useNoStrategy"><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#useNoStrategy"><span class="hs-identifier hs-var hs-var">useNoStrategy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-285"></span><span>    </span><span id="useSerialForCerealAndBinary"><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#useSerialForCerealAndBinary"><span class="hs-identifier hs-var hs-var">useSerialForCerealAndBinary</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><span class="hs-comment">-- | Get all the evaluation modes to specialize in the t'DeriveConfig'.</span></span><span>
</span><span id="line-289"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#evalModeSpecializeList"><span class="hs-identifier hs-type">evalModeSpecializeList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-type">DeriveConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.Unified.EvalModeTag.html#EvalModeTag"><span class="hs-identifier hs-type">EvalModeTag</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span id="evalModeSpecializeList"><span class="annot"><span class="annottext">evalModeSpecializeList :: DeriveConfig -&gt; [(Int, EvalModeTag)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#evalModeSpecializeList"><span class="hs-identifier hs-var hs-var">evalModeSpecializeList</span></a></span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-type">DeriveConfig</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682274690"><span id="local-6989586621682274691"><span id="local-6989586621682274692"><span id="local-6989586621682274693"><span id="local-6989586621682274694"><span id="local-6989586621682274695"><span id="local-6989586621682274696"><span id="local-6989586621682274697"><span class="annot"><span class="annottext">Bool
[Int]
[(Int, Int)]
[(Int, EvalModeConfig)]
evalModeConfig :: DeriveConfig -&gt; [(Int, EvalModeConfig)]
bitSizePositions :: DeriveConfig -&gt; [Int]
fpBitSizePositions :: DeriveConfig -&gt; [(Int, Int)]
unconstrainedPositions :: DeriveConfig -&gt; [Int]
needExtraMergeableUnderEvalMode :: DeriveConfig -&gt; Bool
needExtraMergeableWithConcretizedEvalMode :: DeriveConfig -&gt; Bool
useNoStrategy :: DeriveConfig -&gt; Bool
useSerialForCerealAndBinary :: DeriveConfig -&gt; Bool
evalModeConfig :: [(Int, EvalModeConfig)]
bitSizePositions :: [Int]
fpBitSizePositions :: [(Int, Int)]
unconstrainedPositions :: [Int]
needExtraMergeableUnderEvalMode :: Bool
needExtraMergeableWithConcretizedEvalMode :: Bool
useNoStrategy :: Bool
useSerialForCerealAndBinary :: Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#evalModeConfig"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><span class="annottext">((Int, EvalModeConfig) -&gt; Maybe (Int, EvalModeTag))
-&gt; [(Int, EvalModeConfig)] -&gt; [(Int, EvalModeTag)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682274698"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274698"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274699"><span class="annot"><span class="annottext">EvalModeConfig
</span><a href="#local-6989586621682274699"><span class="hs-identifier hs-var">cfg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EvalModeConfig
</span><a href="#local-6989586621682274699"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-294"></span><span>          </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeConstraints"><span class="hs-identifier hs-type">EvalModeConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Int, EvalModeTag)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-295"></span><span>          </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeSpecified"><span class="hs-identifier hs-type">EvalModeSpecified</span></a></span><span> </span><span id="local-6989586621682274700"><span class="annot"><span class="annottext">EvalModeTag
</span><a href="#local-6989586621682274700"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, EvalModeTag) -&gt; Maybe (Int, EvalModeTag)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274698"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvalModeTag
</span><a href="#local-6989586621682274700"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><span class="annottext">[(Int, EvalModeConfig)]
</span><a href="#local-6989586621682274690"><span class="hs-identifier hs-var">evalModeConfig</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682274703"><span id="local-6989586621682274707"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-type">DeriveConfig</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621682274716"><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682274717"><span class="annot"><span class="annottext">&lt;&gt; :: DeriveConfig -&gt; DeriveConfig -&gt; DeriveConfig
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span id="local-6989586621682274718"><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-type">DeriveConfig</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">evalModeConfig :: [(Int, EvalModeConfig)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#evalModeConfig"><span class="hs-identifier hs-var">evalModeConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; [(Int, EvalModeConfig)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#evalModeConfig"><span class="hs-identifier hs-var">evalModeConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, EvalModeConfig)]
-&gt; [(Int, EvalModeConfig)] -&gt; [(Int, EvalModeConfig)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; [(Int, EvalModeConfig)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#evalModeConfig"><span class="hs-identifier hs-var">evalModeConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">bitSizePositions :: [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#bitSizePositions"><span class="hs-identifier hs-var">bitSizePositions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#bitSizePositions"><span class="hs-identifier hs-var">bitSizePositions</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#bitSizePositions"><span class="hs-identifier hs-var">bitSizePositions</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">fpBitSizePositions :: [(Int, Int)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#fpBitSizePositions"><span class="hs-identifier hs-var">fpBitSizePositions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; [(Int, Int)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#fpBitSizePositions"><span class="hs-identifier hs-var">fpBitSizePositions</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; [(Int, Int)] -&gt; [(Int, Int)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; [(Int, Int)]
</span><a href="Grisette.Internal.TH.GADT.Common.html#fpBitSizePositions"><span class="hs-identifier hs-var">fpBitSizePositions</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><span class="annottext">unconstrainedPositions :: [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#unconstrainedPositions"><span class="hs-identifier hs-var">unconstrainedPositions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#unconstrainedPositions"><span class="hs-identifier hs-var">unconstrainedPositions</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#unconstrainedPositions"><span class="hs-identifier hs-var">unconstrainedPositions</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><span class="annottext">needExtraMergeableUnderEvalMode :: Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#needExtraMergeableUnderEvalMode"><span class="hs-identifier hs-var">needExtraMergeableUnderEvalMode</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-307"></span><span>          </span><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#needExtraMergeableUnderEvalMode"><span class="hs-identifier hs-var">needExtraMergeableUnderEvalMode</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-308"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#needExtraMergeableUnderEvalMode"><span class="hs-identifier hs-var">needExtraMergeableUnderEvalMode</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="annottext">needExtraMergeableWithConcretizedEvalMode :: Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#needExtraMergeableWithConcretizedEvalMode"><span class="hs-identifier hs-var">needExtraMergeableWithConcretizedEvalMode</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-310"></span><span>          </span><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#needExtraMergeableWithConcretizedEvalMode"><span class="hs-identifier hs-var">needExtraMergeableWithConcretizedEvalMode</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-311"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#needExtraMergeableWithConcretizedEvalMode"><span class="hs-identifier hs-var">needExtraMergeableWithConcretizedEvalMode</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-312"></span><span>        </span><span class="annot"><span class="annottext">useNoStrategy :: Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#useNoStrategy"><span class="hs-identifier hs-var">useNoStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#useNoStrategy"><span class="hs-identifier hs-var">useNoStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#useNoStrategy"><span class="hs-identifier hs-var">useNoStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">useSerialForCerealAndBinary :: Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#useSerialForCerealAndBinary"><span class="hs-identifier hs-var">useSerialForCerealAndBinary</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>          </span><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#useSerialForCerealAndBinary"><span class="hs-identifier hs-var">useSerialForCerealAndBinary</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274716"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#useSerialForCerealAndBinary"><span class="hs-identifier hs-var">useSerialForCerealAndBinary</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274718"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-315"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682274725"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-type">DeriveConfig</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-318"></span><span>  </span><span id="local-6989586621682274729"><span class="annot"><span class="annottext">mempty :: DeriveConfig
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, EvalModeConfig)]
-&gt; [Int]
-&gt; [(Int, Int)]
-&gt; [Int]
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; Bool
-&gt; DeriveConfig
</span><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-var">DeriveConfig</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621682274731"><span class="annot"><span class="annottext">mappend :: DeriveConfig -&gt; DeriveConfig -&gt; DeriveConfig
</span><span class="hs-identifier hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveConfig -&gt; DeriveConfig -&gt; DeriveConfig
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">-- | Generate extra constraints for evaluation modes.</span></span><span>
</span><span id="line-322"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraEvalModeConstraint"><span class="hs-identifier hs-type">extraEvalModeConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeConfig"><span class="hs-identifier hs-type">EvalModeConfig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pred</span></span><span class="hs-special">]</span><span>
</span><span id="line-324"></span><span id="extraEvalModeConstraint"><span class="annot"><span class="annottext">extraEvalModeConstraint :: Name -&gt; Name -&gt; [(Kind, Kind)] -&gt; (Int, EvalModeConfig) -&gt; Q [Kind]
</span><a href="Grisette.Internal.TH.GADT.Common.html#extraEvalModeConstraint"><span class="hs-identifier hs-var hs-var">extraEvalModeConstraint</span></a></span></span><span>
</span><span id="line-325"></span><span>  </span><span id="local-6989586621682274732"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274732"><span class="hs-identifier hs-var">tyName</span></a></span></span><span>
</span><span id="line-326"></span><span>  </span><span id="local-6989586621682274733"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274733"><span class="hs-identifier hs-var">instanceName</span></a></span></span><span>
</span><span id="line-327"></span><span>  </span><span id="local-6989586621682274734"><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274734"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682274735"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274735"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeConstraints"><span class="hs-identifier hs-type">EvalModeConstraints</span></a></span><span> </span><span id="local-6989586621682274736"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682274736"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274735"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274734"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Q [Kind]
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682274739"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274739"><span class="hs-identifier hs-var hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274740"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274740"><span class="hs-identifier hs-var hs-var">argKind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274734"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int -&gt; (Kind, Kind)
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274735"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Q () -&gt; Q ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274740"><span class="hs-identifier hs-var">argKind</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EvalModeTag</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; Q ()) -&gt; Q () -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-333"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Q ()
forall a. String -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q ()) -&gt; String -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-334"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot introduce EvalMode constraint for the &quot;</span></span><span>
</span><span id="line-335"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274735"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-336"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;th argument of &quot;</span></span><span>
</span><span id="line-337"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274732"><span class="hs-identifier hs-var">tyName</span></a></span><span>
</span><span id="line-338"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; when deriving the &quot;</span></span><span>
</span><span id="line-339"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274733"><span class="hs-identifier hs-var">instanceName</span></a></span><span>
</span><span id="line-340"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; instance because it is not an EvalModeTag.&quot;</span></span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">(Name -&gt; Q Kind) -&gt; [Name] -&gt; Q [Kind]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682274741"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274741"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[t|</span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Q Kind
forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Kind
</span><span class="hs-identifier hs-var">conT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274741"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274739"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682274736"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-342"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraEvalModeConstraint"><span class="hs-identifier hs-var">extraEvalModeConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeSpecified"><span class="hs-identifier hs-type">EvalModeSpecified</span></a></span><span> </span><span class="annot"><span class="annottext">EvalModeTag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Q [Kind]
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="annot"><span class="hs-comment">-- | Generate extra constraints for bit vectors.</span></span><span>
</span><span id="line-345"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraBitSizeConstraint"><span class="hs-identifier hs-type">extraBitSizeConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pred</span></span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span id="extraBitSizeConstraint"><span class="annot"><span class="annottext">extraBitSizeConstraint :: Name -&gt; Name -&gt; [(Kind, Kind)] -&gt; Int -&gt; Q [Kind]
</span><a href="Grisette.Internal.TH.GADT.Common.html#extraBitSizeConstraint"><span class="hs-identifier hs-var hs-var">extraBitSizeConstraint</span></a></span></span><span> </span><span id="local-6989586621682274742"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274742"><span class="hs-identifier hs-var">tyName</span></a></span></span><span> </span><span id="local-6989586621682274743"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274743"><span class="hs-identifier hs-var">instanceName</span></a></span></span><span> </span><span id="local-6989586621682274744"><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274744"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682274745"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274745"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274745"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274744"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Q [Kind]
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682274748"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274748"><span class="hs-identifier hs-var hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274749"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274749"><span class="hs-identifier hs-var hs-var">argKind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274744"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int -&gt; (Kind, Kind)
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274745"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Q () -&gt; Q ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274749"><span class="hs-identifier hs-var">argKind</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Nat</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; Q ()) -&gt; Q () -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Q ()
forall a. String -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q ()) -&gt; String -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-352"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot introduce BitSize constraint for the &quot;</span></span><span>
</span><span id="line-353"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274745"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-354"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;th argument of &quot;</span></span><span>
</span><span id="line-355"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274742"><span class="hs-identifier hs-var">tyName</span></a></span><span>
</span><span id="line-356"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; when deriving the &quot;</span></span><span>
</span><span id="line-357"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274743"><span class="hs-identifier hs-var">instanceName</span></a></span><span>
</span><span id="line-358"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; instance because it is not a Nat.&quot;</span></span><span>
</span><span id="line-359"></span><span>      </span><span id="local-6989586621682274750"><span class="annot"><a href="#local-6989586621682274750"><span class="hs-identifier hs-var">predKnown</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274748"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-360"></span><span>      </span><span id="local-6989586621682274751"><span class="annot"><a href="#local-6989586621682274751"><span class="hs-identifier hs-var">predPositive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682274748"><span class="hs-identifier hs-type">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682274750"><span class="hs-identifier hs-type">predKnown</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682274751"><span class="hs-identifier hs-type">predPositive</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><span class="hs-comment">-- | Generate extra constraints for floating point exponents and significands.</span></span><span>
</span><span id="line-364"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraFpBitSizeConstraint"><span class="hs-identifier hs-type">extraFpBitSizeConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pred</span></span><span class="hs-special">]</span><span>
</span><span id="line-366"></span><span id="extraFpBitSizeConstraint"><span class="annot"><span class="annottext">extraFpBitSizeConstraint :: Name -&gt; Name -&gt; [(Kind, Kind)] -&gt; (Int, Int) -&gt; Q [Kind]
</span><a href="Grisette.Internal.TH.GADT.Common.html#extraFpBitSizeConstraint"><span class="hs-identifier hs-var hs-var">extraFpBitSizeConstraint</span></a></span></span><span> </span><span id="local-6989586621682274752"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274752"><span class="hs-identifier hs-var">tyName</span></a></span></span><span> </span><span id="local-6989586621682274753"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274753"><span class="hs-identifier hs-var">instanceName</span></a></span></span><span> </span><span id="local-6989586621682274754"><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274754"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682274755"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274755"><span class="hs-identifier hs-var">eb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274756"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274756"><span class="hs-identifier hs-var">sb</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274755"><span class="hs-identifier hs-var">eb</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274754"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274756"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274754"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Q [Kind]
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682274759"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274759"><span class="hs-identifier hs-var hs-var">argEb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274760"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274760"><span class="hs-identifier hs-var hs-var">argEbKind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274754"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int -&gt; (Kind, Kind)
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274755"><span class="hs-identifier hs-var">eb</span></a></span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682274763"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274763"><span class="hs-identifier hs-var hs-var">argSb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274764"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274764"><span class="hs-identifier hs-var hs-var">argSbKind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274754"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)] -&gt; Int -&gt; (Kind, Kind)
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274756"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-371"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Q () -&gt; Q ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274760"><span class="hs-identifier hs-var">argEbKind</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Nat</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274764"><span class="hs-identifier hs-var">argSbKind</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Nat</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; Q ()) -&gt; Q () -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Q ()
forall a. String -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Q ()) -&gt; String -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-373"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot introduce ValidFP constraint for the &quot;</span></span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274755"><span class="hs-identifier hs-var">eb</span></a></span><span>
</span><span id="line-375"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;th and &quot;</span></span><span>
</span><span id="line-376"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274756"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-377"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;th arguments of &quot;</span></span><span>
</span><span id="line-378"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274752"><span class="hs-identifier hs-var">tyName</span></a></span><span>
</span><span id="line-379"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; when deriving the &quot;</span></span><span>
</span><span id="line-380"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274753"><span class="hs-identifier hs-var">instanceName</span></a></span><span>
</span><span id="line-381"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; instance because they are not Nats.&quot;</span></span><span>
</span><span id="line-382"></span><span>      </span><span id="local-6989586621682274765"><span class="annot"><a href="#local-6989586621682274765"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span class="annot"><a href="Grisette.Internal.SymPrim.FP.html#ValidFP"><span class="hs-identifier hs-type">ValidFP</span></a></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274759"><span class="hs-identifier hs-var">argEb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274763"><span class="hs-identifier hs-var">argSb</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-383"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682274765"><span class="hs-identifier hs-type">pred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="annot"><span class="hs-comment">-- | Generate extra constraints for 'Mergeable' instances.</span></span><span>
</span><span id="line-386"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraExtraMergeableConstraint"><span class="hs-identifier hs-type">extraExtraMergeableConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-type">DeriveConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ConstructorInfo</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pred</span></span><span class="hs-special">]</span><span>
</span><span id="line-388"></span><span id="extraExtraMergeableConstraint"><span class="annot"><span class="annottext">extraExtraMergeableConstraint :: DeriveConfig -&gt; [ConstructorInfo] -&gt; [(Kind, Kind)] -&gt; Q [Kind]
</span><a href="Grisette.Internal.TH.GADT.Common.html#extraExtraMergeableConstraint"><span class="hs-identifier hs-var hs-var">extraExtraMergeableConstraint</span></a></span></span><span> </span><span id="local-6989586621682274766"><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274766"><span class="hs-identifier hs-var">deriveConfig</span></a></span></span><span> </span><span id="local-6989586621682274767"><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621682274767"><span class="hs-identifier hs-var">constructors</span></a></span></span><span> </span><span id="local-6989586621682274768"><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274768"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682274769"><span class="annot"><span class="annottext">isTypeUsedInFields' :: Kind -&gt; Bool
</span><a href="#local-6989586621682274769"><span class="hs-identifier hs-var hs-var">isTypeUsedInFields'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VarT</span></span><span> </span><span id="local-6989586621682274770"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274770"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>        </span><span class="annot"><span class="annottext">[ConstructorInfo] -&gt; Name -&gt; Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#isVarUsedInConstructorFields"><span class="hs-identifier hs-var">isVarUsedInConstructorFields</span></a></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621682274767"><span class="hs-identifier hs-var">constructors</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274770"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-391"></span><span>      </span><span class="annot"><a href="#local-6989586621682274769"><span class="hs-identifier hs-var">isTypeUsedInFields'</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><span class="annottext">[Maybe Kind] -&gt; [Kind]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="annottext">([Maybe Kind] -&gt; [Kind]) -&gt; Q [Maybe Kind] -&gt; Q [Kind]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Kind, Kind) -&gt; Q (Maybe Kind))
-&gt; [Int] -&gt; [(Kind, Kind)] -&gt; Q [Maybe Kind]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span>
</span><span id="line-394"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682274771"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274771"><span class="hs-identifier hs-var">position</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682274772"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274772"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274773"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274773"><span class="hs-identifier hs-var">knd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="#local-6989586621682274769"><span class="hs-identifier hs-var">isTypeUsedInFields'</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274772"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-396"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">notElem</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682274771"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeriveConfig -&gt; [Int]
</span><a href="Grisette.Internal.TH.GADT.Common.html#unconstrainedPositions"><span class="hs-identifier hs-var">unconstrainedPositions</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveConfig
</span><a href="#local-6989586621682274766"><span class="hs-identifier hs-var">deriveConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-398"></span><span>              </span><span class="annot"><span class="annottext">[Kind] -&gt; Kind -&gt; Kind -&gt; Q (Maybe Kind)
</span><a href="Grisette.Internal.TH.GADT.Common.html#ctxForVar"><span class="hs-identifier hs-var">ctxForVar</span></a></span><span>
</span><span id="line-399"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Mergeable</span><span class="hs-special">,</span><span>
</span><span id="line-400"></span><span>                  </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Mergeable1</span><span class="hs-special">,</span><span>
</span><span id="line-401"></span><span>                  </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Mergeable2</span><span>
</span><span id="line-402"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-403"></span><span>                </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274772"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-404"></span><span>                </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274773"><span class="hs-identifier hs-var">knd</span></a></span><span>
</span><span id="line-405"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Kind -&gt; Q (Maybe Kind)
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-408"></span><span>      </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274768"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="annot"><span class="hs-comment">-- | Generate extra constraints for a GADT.</span></span><span>
</span><span id="line-411"></span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraConstraint"><span class="hs-identifier hs-type">extraConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-type">DeriveConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-413"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ConstructorInfo</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pred</span></span><span class="hs-special">]</span><span>
</span><span id="line-419"></span><span id="extraConstraint"><span class="annot"><span class="annottext">extraConstraint :: DeriveConfig
-&gt; Name
-&gt; Name
-&gt; [(Kind, Kind)]
-&gt; [(Kind, Kind)]
-&gt; [ConstructorInfo]
-&gt; Q [Kind]
</span><a href="Grisette.Internal.TH.GADT.Common.html#extraConstraint"><span class="hs-identifier hs-var hs-var">extraConstraint</span></a></span></span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621682274775"><span class="annot"><span class="annottext">deriveConfig :: DeriveConfig
</span><a href="#local-6989586621682274775"><span class="hs-identifier hs-var">deriveConfig</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#DeriveConfig"><span class="hs-identifier hs-type">DeriveConfig</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682274776"><span id="local-6989586621682274777"><span id="local-6989586621682274778"><span id="local-6989586621682274779"><span id="local-6989586621682274780"><span id="local-6989586621682274781"><span id="local-6989586621682274782"><span id="local-6989586621682274783"><span class="annot"><span class="annottext">Bool
[Int]
[(Int, Int)]
[(Int, EvalModeConfig)]
evalModeConfig :: DeriveConfig -&gt; [(Int, EvalModeConfig)]
bitSizePositions :: DeriveConfig -&gt; [Int]
fpBitSizePositions :: DeriveConfig -&gt; [(Int, Int)]
unconstrainedPositions :: DeriveConfig -&gt; [Int]
needExtraMergeableUnderEvalMode :: DeriveConfig -&gt; Bool
needExtraMergeableWithConcretizedEvalMode :: DeriveConfig -&gt; Bool
useNoStrategy :: DeriveConfig -&gt; Bool
useSerialForCerealAndBinary :: DeriveConfig -&gt; Bool
evalModeConfig :: [(Int, EvalModeConfig)]
bitSizePositions :: [Int]
fpBitSizePositions :: [(Int, Int)]
unconstrainedPositions :: [Int]
needExtraMergeableUnderEvalMode :: Bool
needExtraMergeableWithConcretizedEvalMode :: Bool
useNoStrategy :: Bool
useSerialForCerealAndBinary :: Bool
</span><a href="Grisette.Internal.TH.GADT.Common.html#evalModeConfig"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-421"></span><span>  </span><span id="local-6989586621682274784"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274784"><span class="hs-identifier hs-var">tyName</span></a></span></span><span>
</span><span id="line-422"></span><span>  </span><span id="local-6989586621682274785"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274785"><span class="hs-identifier hs-var">instanceName</span></a></span></span><span>
</span><span id="line-423"></span><span>  </span><span id="local-6989586621682274786"><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274786"><span class="hs-identifier hs-var">extraArgs</span></a></span></span><span>
</span><span id="line-424"></span><span>  </span><span id="local-6989586621682274787"><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274787"><span class="hs-identifier hs-var">keptArgs</span></a></span></span><span>
</span><span id="line-425"></span><span>  </span><span id="local-6989586621682274788"><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621682274788"><span class="hs-identifier hs-var">constructors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621682274789"><span class="annot"><a href="#local-6989586621682274789"><span class="hs-identifier hs-var">evalModePreds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-427"></span><span>      </span><span class="annot"><span class="annottext">((Int, EvalModeConfig) -&gt; Q [Kind])
-&gt; [(Int, EvalModeConfig)] -&gt; Q [[Kind]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; [(Kind, Kind)] -&gt; (Int, EvalModeConfig) -&gt; Q [Kind]
</span><a href="Grisette.Internal.TH.GADT.Common.html#extraEvalModeConstraint"><span class="hs-identifier hs-var">extraEvalModeConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274784"><span class="hs-identifier hs-var">tyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682274785"><span class="hs-identifier hs-var">instanceName</span></a></span><span> </span><span class="annot"><span class="annottext">[(Kind, Kind)]
</span><a href="#local-6989586621682274787"><span class="hs-identifier hs-var">keptArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>        </span><span class="annot"><span class="annottext">[(Int, EvalModeConfig)]
</span><a href="#local-6989586621682274776"><span class="hs-identifier hs-var">evalModeConfig</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621682274790"><span class="annot"><a href="#local-6989586621682274790"><span class="hs-identifier hs-var">extraArgEvalModePreds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-431"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682274776"><span class="hs-identifier hs-type">evalModeConfig</span></a></span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-433"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span>
</span><span id="line-434"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682274791"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274791"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682274792"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274792"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-435"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274792"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EvalModeTag</span><span>
</span><span id="line-436"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; [Kind] -&gt; [Kind]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Kind -&gt; [Kind]) -&gt; Q Kind -&gt; Q [Kind]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">[t|</span><span class="annot"><a href="Grisette.Internal.Unified.Util.html#DecideEvalMode"><span class="hs-identifier hs-type">DecideEvalMode</span></a></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621682274791"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-437"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; Q [Kind]
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-438"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>            </span><span class="annot"><a href="#local-6989586621682274786"><span class="hs-identifier hs-type">extraArgs</span></a></span><span>
</span><span id="line-440"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-441"></span><span>    </span><span id="local-6989586621682274793"><span class="annot"><a href="#local-6989586621682274793"><span class="hs-identifier hs-var">bitSizePreds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-442"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span>
</span><span id="line-443"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraBitSizeConstraint"><span class="hs-identifier hs-type">extraBitSizeConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274784"><span class="hs-identifier hs-type">tyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274785"><span class="hs-identifier hs-type">instanceName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274787"><span class="hs-identifier hs-type">keptArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>        </span><span class="annot"><a href="#local-6989586621682274777"><span class="hs-identifier hs-type">bitSizePositions</span></a></span><span>
</span><span id="line-445"></span><span>    </span><span id="local-6989586621682274794"><span class="annot"><a href="#local-6989586621682274794"><span class="hs-identifier hs-var">fpBitSizePreds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-446"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraFpBitSizeConstraint"><span class="hs-identifier hs-type">extraFpBitSizeConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274784"><span class="hs-identifier hs-type">tyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274785"><span class="hs-identifier hs-type">instanceName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274787"><span class="hs-identifier hs-type">keptArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>        </span><span class="annot"><a href="#local-6989586621682274778"><span class="hs-identifier hs-type">fpBitSizePositions</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span id="local-6989586621682274795"><span class="annot"><a href="#local-6989586621682274795"><span class="hs-identifier hs-var">extraMergeablePreds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-450"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682274780"><span class="hs-identifier hs-type">needExtraMergeableUnderEvalMode</span></a></span><span>
</span><span id="line-451"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span>
</span><span id="line-452"></span><span>               </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-453"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeConstraints"><span class="hs-identifier hs-type">EvalModeConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-454"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#EvalModeSpecified"><span class="hs-identifier hs-type">EvalModeSpecified</span></a></span><span> </span><span class="annot"><span class="annottext">EvalModeTag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-455"></span><span>               </span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>               </span><span class="annot"><a href="#local-6989586621682274776"><span class="hs-identifier hs-type">evalModeConfig</span></a></span><span>
</span><span id="line-457"></span><span>               </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621682274781"><span class="hs-identifier hs-type">needExtraMergeableWithConcretizedEvalMode</span></a></span><span>
</span><span id="line-458"></span><span>           </span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Grisette.Internal.TH.GADT.Common.html#extraExtraMergeableConstraint"><span class="hs-identifier hs-type">extraExtraMergeableConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274775"><span class="hs-identifier hs-type">deriveConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274788"><span class="hs-identifier hs-type">constructors</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682274787"><span class="hs-identifier hs-type">keptArgs</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-461"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-462"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682274790"><span class="hs-identifier hs-type">extraArgEvalModePreds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682274789"><span class="hs-identifier hs-type">evalModePreds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682274788"><span class="hs-identifier hs-type">constructors</span></a></span><span>
</span><span id="line-464"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-465"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621682274795"><span class="hs-identifier hs-type">extraMergeablePreds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682274793"><span class="hs-identifier hs-type">bitSizePreds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682274794"><span class="hs-identifier hs-type">fpBitSizePreds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span></pre></body></html>